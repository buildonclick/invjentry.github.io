<!DOCTYPE html>
<html>
<head>
    <title>Nearby Restaurants Finder</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
            max-width: 800px;
            margin: 0 auto;
        }
        h1 { 
            color: #333; 
            text-align: center;
        }
        #location-info, #status, #results {
            margin: 15px 0;
            padding: 15px;
            border-radius: 6px;
        }
        #location-info { 
            background: #e8f4fd; 
            border-left: 4px solid #4285f4; 
        }
        #status { 
            background: #fff; 
            min-height: 20px;
        }
        #results { 
            background: #fff; 
            min-height: 100px;
        }
        .place {
            padding: 12px;
            border-bottom: 1px solid #eee;
            margin: 8px 0;
            border-radius: 4px;
            background: #fafafa;
        }
        .place:last-child {
            border-bottom: none;
        }
        button {
            background-color: #4285f4;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 0;
        }
        button:hover {
            background-color: #3367d6;
        }
        button:disabled { 
            background-color: #a0c3ff; 
            cursor: not-allowed; 
        }
        .error { 
            color: #d93025; 
            background: #fce8e6; 
            padding: 12px; 
            border-radius: 4px; 
        }
        .success { 
            color: #137333; 
            background: #e6f4ea; 
            padding: 12px; 
            border-radius: 4px; 
        }
        .warning { 
            color: #f9ab00; 
            background: #fff8e1; 
            padding: 12px; 
            border-radius: 4px; 
        }
        .loading { 
            color: #666; 
            text-align: center; 
            padding: 20px; 
        }
        .billing-info {
            background: #fff8e1;
            border: 1px solid #f9ab00;
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
        }
    </style>
</head>
<body>

<h1>üçΩÔ∏è Nearby Restaurants Finder</h1>

<button id="search-btn" onclick="getLocationAndSearch()">Find Nearby Restaurants</button>

<div id="location-info">
    <strong>üìç Your Location:</strong> Click the button to find restaurants near you
</div>

<div id="status">
    <!-- Status messages will appear here -->
</div>

<div id="results">
    <!-- Results will appear here -->
</div>

<div class="billing-info">
    <strong>üí≥ Billing Setup Required:</strong>
    <p>Google Places API requires billing to be enabled. Please:</p>
    <ol>
        <li>Go to <a href="https://console.cloud.google.com/billing" target="_blank">Google Cloud Console ‚Üí Billing</a></li>
        <li>Ensure you have a billing account linked to your project</li>
        <li>Wait 2-5 minutes after setup</li>
    </ol>
    <p><small>Note: You get $200 free monthly credit, so you won't be charged for normal usage.</small></p>
</div>

<script>
let map;
let service;
let userLocation = null;
let googleLoaded = false;

function initMap() {
    console.log("Google Maps API loaded successfully");
    googleLoaded = true;
    
    // Create minimal map
    map = new google.maps.Map(document.getElementById("map"), {
        center: { lat: 0, lng: 0 },
        zoom: 2
    });

    service = new google.maps.places.PlacesService(map);
    updateStatus('‚úÖ Google Maps API loaded successfully', 'success');
}

function updateStatus(message, type = 'info') {
    const statusDiv = document.getElementById('status');
    const className = type === 'error' ? 'error' : type === 'success' ? 'success' : type === 'warning' ? 'warning' : '';
    statusDiv.innerHTML = `<div class="${className}">${message}</div>`;
}

function getLocationAndSearch() {
    const searchBtn = document.getElementById('search-btn');
    searchBtn.disabled = true;
    searchBtn.textContent = "Finding Location...";
    
    updateStatus('üìç Detecting your location...');
    document.getElementById('results').innerHTML = '<div class="loading">Finding your location...</div>';

    if (!navigator.geolocation) {
        updateStatus('‚ùå Geolocation is not supported by your browser', 'error');
        searchBtn.disabled = false;
        searchBtn.textContent = "Find Nearby Restaurants";
        return;
    }

    navigator.geolocation.getCurrentPosition(
        position => {
            userLocation = {
                lat: position.coords.latitude,
                lng: position.coords.longitude
            };
            
            document.getElementById('location-info').innerHTML = 
                `<strong>üìç Your Current Location:</strong><br>
                 Latitude: ${userLocation.lat.toFixed(6)}<br>
                 Longitude: ${userLocation.lng.toFixed(6)}`;
            
            updateStatus('‚úÖ Location found! Searching for restaurants...', 'success');
            searchNearbyPlaces();
        },
        error => {
            let errorMessage = "‚ùå Location Error: ";
            switch(error.code) {
                case error.PERMISSION_DENIED:
                    errorMessage += "Please allow location access in your browser settings.";
                    break;
                case error.POSITION_UNAVAILABLE:
                    errorMessage += "Location information is unavailable.";
                    break;
                case error.TIMEOUT:
                    errorMessage += "Location request timed out.";
                    break;
                default:
                    errorMessage += "An unknown error occurred.";
                    break;
            }
            
            updateStatus(errorMessage, 'error');
            document.getElementById('results').innerHTML = "";
            
            searchBtn.disabled = false;
            searchBtn.textContent = "Find Nearby Restaurants";
        },
        {
            enableHighAccuracy: true,
            timeout: 10000,
            maximumAge: 60000
        }
    );
}

function searchNearbyPlaces() {
    const searchBtn = document.getElementById('search-btn');
    searchBtn.textContent = "Searching Restaurants...";
    
    document.getElementById('results').innerHTML = '<div class="loading">Searching for nearby restaurants...</div>';

    if (!userLocation) {
        updateStatus('‚ùå Location not available', 'error');
        searchBtn.disabled = false;
        searchBtn.textContent = "Find Nearby Restaurants";
        return;
    }

    const request = {
        location: new google.maps.LatLng(userLocation.lat, userLocation.lng),
        radius: 10000, // 10km
        type: ["restaurant"]
    };

    // Set timeout for API call
    const apiTimeout = setTimeout(() => {
        updateStatus('‚ùå Request timeout - Places API may require billing setup', 'error');
        document.getElementById('results').innerHTML = `
            <div class="error">
                <strong>API Request Timed Out</strong><br>
                This usually means:<br>
                1. Places API is not enabled, OR<br>
                2. Billing is not set up for your Google Cloud project<br><br>
                Please check the billing setup instructions below.
            </div>
        `;
        searchBtn.disabled = false;
        searchBtn.textContent = "Find Nearby Restaurants";
    }, 10000);

    service.nearbySearch(request, (results, status) => {
        clearTimeout(apiTimeout);
        
        searchBtn.disabled = false;
        searchBtn.textContent = "Find Nearby Restaurants";

        if (status !== google.maps.places.PlacesServiceStatus.OK) {
            let errorMsg = "‚ùå Search Error: ";
            switch(status) {
                case google.maps.places.PlacesServiceStatus.ZERO_RESULTS:
                    errorMsg = "No restaurants found within 10km of your location.";
                    break;
                case google.maps.places.PlacesServiceStatus.INVALID_REQUEST:
                    errorMsg = "Invalid API request. Please check your API key configuration.";
                    break;
                case google.maps.places.PlacesServiceStatus.OVER_QUERY_LIMIT:
                    errorMsg = "API quota exceeded. Please try again later.";
                    break;
                case google.maps.places.PlacesServiceStatus.REQUEST_DENIED:
                    errorMsg = "API request denied. Please ensure Places API is enabled and billing is set up.";
                    break;
                case google.maps.places.PlacesServiceStatus.UNKNOWN_ERROR:
                    errorMsg = "Unknown error occurred. Please try again.";
                    break;
                default:
                    errorMsg += status;
            }
            
            updateStatus(errorMsg, 'error');
            document.getElementById('results').innerHTML = "";
            return;
        }

        // Success! Display results
        updateStatus(`‚úÖ Found ${results.length} restaurants near you!`, 'success');

        let html = "";
        if (results.length === 0) {
            html = "<div class='warning'>No restaurants found within 10km radius.</div>";
        } else {
            results.forEach(place => {
                const rating = place.rating ? `${place.rating} ‚≠ê` : "No rating";
                const priceLevel = place.price_level ? '$'.repeat(place.price_level) : '';
                
                html += `
                    <div class="place">
                        <strong>${place.name}</strong><br>
                        Rating: ${rating} ${priceLevel}<br>
                        Address: ${place.vicinity || "Address not available"}
                    </div>
                `;
            });
        }

        document.getElementById('results').innerHTML = html;
    });
}

// Check if Google Maps API loaded properly
setTimeout(() => {
    if (!googleLoaded) {
        updateStatus('‚ùå Google Maps API failed to load. Please check your API key and restrictions.', 'error');
    }
}, 5000);
</script>

<!-- Hidden map container -->
<div id="map" style="height:0; width:0;"></div>

<!-- Google Maps JS API + Places Library -->
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBz8TJrPNKb7lzxwLC4P6C6vWl7Ut3akOY&libraries=places&callback=initMap"
        async defer></script>

</body>
</html>
