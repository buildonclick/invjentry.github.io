<!DOCTYPE html>
<html>
<head>
    <title>Nearby Places Finder</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
            max-width: 800px;
            margin: 0 auto;
        }
        h1 { 
            color: #333; 
            text-align: center;
        }
        #location-info {
            margin: 15px 0;
            padding: 10px;
            background: #e8f4fd;
            border-radius: 6px;
            border-left: 4px solid #4285f4;
        }
        #results {
            margin-top: 20px;
            padding: 10px;
            background: #fff;
            border-radius: 6px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .place {
            padding: 10px;
            border-bottom: 1px solid #eee;
        }
        .place:last-child {
            border-bottom: none;
        }
        button {
            background-color: #4285f4;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #3367d6;
        }
        button:disabled {
            background-color: #a0c3ff;
            cursor: not-allowed;
        }
        .error {
            color: #d93025;
            background: #fce8e6;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .loading {
            color: #666;
            text-align: center;
            padding: 20px;
        }
        .status {
            margin: 10px 0;
            padding: 8px;
            border-radius: 4px;
        }
        .success {
            background-color: #e6f4ea;
            color: #137333;
        }
    </style>
</head>
<body>

<h1>Nearby Places Finder</h1>

<button id="search-btn" onclick="getLocationAndSearch()">Find Nearby Places</button>

<div id="location-info">Your location will appear here...</div>
<div id="status"></div>
<div id="results">Results will appear here...</div>

<!-- Hidden map container (required by Google) -->
<div id="map" style="height:0; width:0;"></div>

<script>
let map;
let service;
let userLocation = null;

function initMap() {
    // Create a minimal map (required by Google Places API)
    map = new google.maps.Map(document.getElementById("map"), {
        center: { lat: 0, lng: 0 },
        zoom: 2
    });

    service = new google.maps.places.PlacesService(map);
}

function getLocationAndSearch() {
    // Disable button while processing
    const searchBtn = document.getElementById("search-btn");
    searchBtn.disabled = true;
    searchBtn.textContent = "Finding your location...";
    
    document.getElementById("status").innerHTML = "";
    document.getElementById("results").innerHTML = '<div class="loading">Finding your location...</div>';
    
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
            position => {
                // Successfully got location
                userLocation = {
                    lat: position.coords.latitude,
                    lng: position.coords.longitude
                };
                
                // Update UI with location info
                document.getElementById("location-info").innerHTML = 
                    `Your current location: <br>
                     Latitude: ${userLocation.lat.toFixed(6)}<br>
                     Longitude: ${userLocation.lng.toFixed(6)}`;
                
                // Now search for nearby places
                searchNearbyPlaces();
            },
            error => {
                // Handle location errors
                let errorMessage = "Unable to retrieve your location: ";
                switch(error.code) {
                    case error.PERMISSION_DENIED:
                        errorMessage += "Permission denied. Please allow location access.";
                        break;
                    case error.POSITION_UNAVAILABLE:
                        errorMessage += "Location information is unavailable.";
                        break;
                    case error.TIMEOUT:
                        errorMessage += "Location request timed out.";
                        break;
                    default:
                        errorMessage += "An unknown error occurred.";
                        break;
                }
                
                document.getElementById("status").innerHTML = `<div class="error">${errorMessage}</div>`;
                document.getElementById("results").innerHTML = "";
                
                // Re-enable button
                searchBtn.disabled = false;
                searchBtn.textContent = "Find Nearby Places";
            },
            {
                enableHighAccuracy: true,
                timeout: 10000,
                maximumAge: 60000
            }
        );
    } else {
        // Browser doesn't support geolocation
        document.getElementById("status").innerHTML = 
            '<div class="error">Geolocation is not supported by this browser.</div>';
        document.getElementById("results").innerHTML = "";
        
        // Re-enable button
        searchBtn.disabled = false;
        searchBtn.textContent = "Find Nearby Places";
    }
}

function searchNearbyPlaces() {
    const searchBtn = document.getElementById("search-btn");
    searchBtn.textContent = "Searching for nearby places...";
    
    document.getElementById("results").innerHTML = '<div class="loading">Searching for nearby places...</div>';
    
    if (!userLocation) {
        document.getElementById("status").innerHTML = 
            '<div class="error">Location not available. Please try again.</div>';
        
        // Re-enable button
        searchBtn.disabled = false;
        searchBtn.textContent = "Find Nearby Places";
        return;
    }

    const request = {
        location: new google.maps.LatLng(userLocation.lat, userLocation.lng),
        radius: 10000, // 10km in meters
        type: ["restaurant"]
    };

    service.nearbySearch(request, (results, status) => {
        // Re-enable button
        searchBtn.disabled = false;
        searchBtn.textContent = "Find Nearby Places";
        
        if (status !== google.maps.places.PlacesServiceStatus.OK) {
            let errorMsg = "Error searching for places: ";
            switch(status) {
                case google.maps.places.PlacesServiceStatus.ZERO_RESULTS:
                    errorMsg += "No places found nearby.";
                    break;
                case google.maps.places.PlacesServiceStatus.INVALID_REQUEST:
                    errorMsg += "Invalid request.";
                    break;
                case google.maps.places.PlacesServiceStatus.OVER_QUERY_LIMIT:
                    errorMsg += "Query limit exceeded.";
                    break;
                case google.maps.places.PlacesServiceStatus.REQUEST_DENIED:
                    errorMsg += "Request denied.";
                    break;
                case google.maps.places.PlacesServiceStatus.UNKNOWN_ERROR:
                    errorMsg += "Unknown error occurred.";
                    break;
                default:
                    errorMsg += status;
            }
            
            document.getElementById("status").innerHTML = `<div class="error">${errorMsg}</div>`;
            document.getElementById("results").innerHTML = "";
            return;
        }

        // Show success message
        document.getElementById("status").innerHTML = 
            `<div class="status success">Found ${results.length} places near you!</div>`;

        // Display results
        let html = "";
        
        if (results.length === 0) {
            html = "<div class='loading'>No restaurants found within 10km of your location.</div>";
        } else {
            results.forEach(place => {
                html += `
                    <div class="place">
                        <strong>${place.name}</strong><br>
                        Rating: ${place.rating ?? "N/A"}<br>
                        Address: ${place.vicinity ?? "No address available"}
                    </div>
                `;
            });
        }

        document.getElementById("results").innerHTML = html;
    });
}
</script>

<!-- Google Maps JS API + Places Library -->
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBz8TJrPNKb7lzxwLC4P6C6vWl7Ut3akOY&libraries=places&callback=initMap"
        async defer></script>

</body>
</html>
