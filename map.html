<!DOCTYPE html>
<html>
<head>
    <title>Nearby Places Finder - invjentry.github.io</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
            max-width: 800px;
            margin: 0 auto;
        }
        h1 { 
            color: #333; 
            text-align: center;
        }
        #location-info {
            margin: 15px 0;
            padding: 10px;
            background: #e8f4fd;
            border-radius: 6px;
            border-left: 4px solid #4285f4;
        }
        #results {
            margin-top: 20px;
            padding: 10px;
            background: #fff;
            border-radius: 6px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .place {
            padding: 10px;
            border-bottom: 1px solid #eee;
        }
        .place:last-child {
            border-bottom: none;
        }
        button {
            background-color: #4285f4;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #3367d6;
        }
        button:disabled {
            background-color: #a0c3ff;
            cursor: not-allowed;
        }
        .error {
            color: #d93025;
            background: #fce8e6;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .loading {
            color: #666;
            text-align: center;
            padding: 20px;
        }
        .status {
            margin: 10px 0;
            padding: 8px;
            border-radius: 4px;
        }
        .success {
            background-color: #e6f4ea;
            color: #137333;
        }
        .debug {
            background: #f8f9fa;
            border: 1px solid #dadce0;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-size: 14px;
        }
    </style>
</head>
<body>

<h1>Nearby Places Finder</h1>
<p>Testing from: invjentry.github.io/map.html</p>

<button id="search-btn" onclick="getLocationAndSearch()">Find Nearby Restaurants</button>

<div id="location-info">Click the button to find your location and nearby restaurants</div>
<div id="status"></div>
<div id="debug"></div>
<div id="results">Results will appear here...</div>

<!-- Hidden map container -->
<div id="map" style="height:0; width:0;"></div>

<script>
let map;
let service;
let userLocation = null;
let googleLoaded = false;

function debugLog(message) {
    const debugDiv = document.getElementById("debug");
    debugDiv.innerHTML += `<div class="debug">${message}</div>`;
    console.log(message);
}

function initMap() {
    console.log("Google Maps API loaded successfully");
    googleLoaded = true;
    
    // Create minimal map
    map = new google.maps.Map(document.getElementById("map"), {
        center: { lat: 0, lng: 0 },
        zoom: 2
    });

    service = new google.maps.places.PlacesService(map);
    debugLog('‚úÖ Google Maps API initialized successfully');
}

function getLocationAndSearch() {
    document.getElementById("debug").innerHTML = '';
    
    if (!googleLoaded) {
        debugLog("‚ùå Google Maps API not loaded yet");
        document.getElementById("status").innerHTML = '<div class="error">Google Maps API is still loading. Please wait...</div>';
        return;
    }

    const searchBtn = document.getElementById("search-btn");
    searchBtn.disabled = true;
    searchBtn.textContent = "Finding your location...";
    
    document.getElementById("status").innerHTML = "";
    document.getElementById("results").innerHTML = '<div class="loading">Finding your location...</div>';
    
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
            position => {
                userLocation = {
                    lat: position.coords.latitude,
                    lng: position.coords.longitude
                };
                
                document.getElementById("location-info").innerHTML = 
                    `üìç Your current location: <br>
                     Latitude: ${userLocation.lat.toFixed(6)}<br>
                     Longitude: ${userLocation.lng.toFixed(6)}`;
                
                debugLog(`üìç Location obtained: ${userLocation.lat}, ${userLocation.lng}`);
                searchNearbyPlaces();
            },
            error => {
                let errorMessage = "Location Error: ";
                switch(error.code) {
                    case error.PERMISSION_DENIED:
                        errorMessage += "Please allow location access in your browser.";
                        break;
                    case error.POSITION_UNAVAILABLE:
                        errorMessage += "Location unavailable.";
                        break;
                    case error.TIMEOUT:
                        errorMessage += "Location request timed out.";
                        break;
                    default:
                        errorMessage += "Unknown error.";
                        break;
                }
                
                debugLog(`‚ùå ${errorMessage}`);
                document.getElementById("status").innerHTML = `<div class="error">${errorMessage}</div>`;
                document.getElementById("results").innerHTML = "";
                
                searchBtn.disabled = false;
                searchBtn.textContent = "Find Nearby Restaurants";
            },
            {
                enableHighAccuracy: true,
                timeout: 10000,
                maximumAge: 60000
            }
        );
    } else {
        debugLog("‚ùå Geolocation not supported");
        document.getElementById("status").innerHTML = '<div class="error">Geolocation not supported by your browser.</div>';
        searchBtn.disabled = false;
        searchBtn.textContent = "Find Nearby Restaurants";
    }
}

function searchNearbyPlaces() {
    const searchBtn = document.getElementById("search-btn");
    searchBtn.textContent = "Searching for restaurants...";
    document.getElementById("results").innerHTML = '<div class="loading">Searching for nearby restaurants...</div>';

    debugLog(`üîç Searching for restaurants near: ${userLocation.lat}, ${userLocation.lng}`);
    
    const request = {
        location: new google.maps.LatLng(userLocation.lat, userLocation.lng),
        radius: 10000, // 10km
        type: ["restaurant"]
    };

    service.nearbySearch(request, (results, status) => {
        debugLog(`üìã API Response: ${status}`);
        
        searchBtn.disabled = false;
        searchBtn.textContent = "Find Nearby Restaurants";
        
        if (status !== google.maps.places.PlacesServiceStatus.OK) {
            let errorMsg = "Search Error: ";
            switch(status) {
                case google.maps.places.PlacesServiceStatus.ZERO_RESULTS:
                    errorMsg = "No restaurants found within 10km. Try a larger area.";
                    break;
                case google.maps.places.PlacesServiceStatus.INVALID_REQUEST:
                    errorMsg = "Invalid API request. Check API key permissions.";
                    break;
                case google.maps.places.PlacesServiceStatus.OVER_QUERY_LIMIT:
                    errorMsg = "API quota exceeded. Try again tomorrow.";
                    break;
                case google.maps.places.PlacesServiceStatus.REQUEST_DENIED:
                    errorMsg = "API request denied. Check if Places API is enabled.";
                    break;
                case google.maps.places.PlacesServiceStatus.UNKNOWN_ERROR:
                    errorMsg = "Unknown API error. Please try again.";
                    break;
                default:
                    errorMsg += status;
            }
            
            debugLog(`‚ùå ${errorMsg}`);
            document.getElementById("status").innerHTML = `<div class="error">${errorMsg}</div>`;
            document.getElementById("results").innerHTML = "";
            return;
        }

        debugLog(`‚úÖ Found ${results.length} restaurants`);
        document.getElementById("status").innerHTML = 
            `<div class="status success">Found ${results.length} restaurants near you!</div>`;

        let html = "";
        if (results.length === 0) {
            html = "<div class='loading'>No restaurants found within 10km.</div>";
        } else {
            results.forEach(place => {
                html += `
                    <div class="place">
                        <strong>${place.name}</strong><br>
                        ‚≠ê Rating: ${place.rating || "N/A"}<br>
                        üìç Address: ${place.vicinity || "Address not available"}
                    </div>
                `;
            });
        }

        document.getElementById("results").innerHTML = html;
    });
}

// Check if API loads
setTimeout(() => {
    if (!googleLoaded) {
        document.getElementById("debug").innerHTML = 
            '<div class="error">Google Maps API failed to load. Check:<br>1. API key restrictions<br>2. Places API is enabled<br>3. Billing is set up</div>';
    }
}, 5000);
</script>

<!-- Google Maps API -->
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBz8TJrPNKb7lzxwLC4P6C6vWl7Ut3akOY&libraries=places&callback=initMap" async defer></script>

</body>
</html>
