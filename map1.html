<!DOCTYPE html>
<html>
<head>
    <title>Nearby Restaurants - Free Alternative</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
            max-width: 800px;
            margin: 0 auto;
        }
        h1 { 
            color: #333; 
            text-align: center;
        }
        #location-info, #status, #results {
            margin: 15px 0;
            padding: 15px;
            border-radius: 6px;
        }
        #location-info { 
            background: #e8f4fd; 
            border-left: 4px solid #4285f4; 
        }
        #status { 
            background: #fff; 
        }
        #results { 
            background: #fff; 
        }
        .place {
            padding: 12px;
            border-bottom: 1px solid #eee;
            margin: 8px 0;
            border-radius: 4px;
            background: #fafafa;
        }
        button {
            background-color: #4285f4;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 0;
        }
        button:disabled { 
            background-color: #a0c3ff; 
            cursor: not-allowed; 
        }
        .error { 
            color: #d93025; 
            background: #fce8e6; 
            padding: 12px; 
            border-radius: 4px; 
        }
        .success { 
            color: #137333; 
            background: #e6f4ea; 
            padding: 12px; 
            border-radius: 4px; 
        }
        .loading { 
            color: #666; 
            text-align: center; 
            padding: 20px; 
        }
        .info-box {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
        }
    </style>
</head>
<body>

<h1>üçΩÔ∏è Nearby Restaurants Finder (Free API)</h1>

<div class="info-box">
    <strong>‚ÑπÔ∏è Using OpenStreetMap - No Google API Required</strong>
    <p>This version uses free open data - no billing setup needed!</p>
</div>

<button id="search-btn" onclick="findNearbyRestaurants()">Find Nearby Restaurants</button>

<div id="location-info">
    <strong>üìç Your Location:</strong> Click the button to start
</div>

<div id="status">
    <!-- Status messages will appear here -->
</div>

<div id="results">
    <!-- Results will appear here -->
</div>

<script>
let userLocation = null;

function updateStatus(message, type = 'info') {
    const statusDiv = document.getElementById('status');
    const className = type === 'error' ? 'error' : type === 'success' ? 'success' : '';
    statusDiv.innerHTML = `<div class="${className}">${message}</div>`;
}

function findNearbyRestaurants() {
    const searchBtn = document.getElementById('search-btn');
    searchBtn.disabled = true;
    searchBtn.textContent = "Finding Location...";
    
    updateStatus('üìç Detecting your location...');
    document.getElementById('results').innerHTML = '<div class="loading">Finding your location...</div>';

    if (!navigator.geolocation) {
        updateStatus('‚ùå Geolocation not supported by your browser', 'error');
        searchBtn.disabled = false;
        searchBtn.textContent = "Find Nearby Restaurants";
        return;
    }

    navigator.geolocation.getCurrentPosition(
        async (position) => {
            userLocation = {
                lat: position.coords.latitude,
                lng: position.coords.longitude
            };
            
            document.getElementById('location-info').innerHTML = 
                `<strong>üìç Your Current Location:</strong><br>
                 Latitude: ${userLocation.lat.toFixed(6)}<br>
                 Longitude: ${userLocation.lng.toFixed(6)}`;
            
            updateStatus('‚úÖ Location found! Searching restaurants...', 'success');
            
            // Search using Overpass API
            await searchWithOverpassAPI();
            
            searchBtn.disabled = false;
            searchBtn.textContent = "Find Nearby Restaurants";
        },
        (error) => {
            let errorMessage = "‚ùå Location Error: ";
            switch(error.code) {
                case error.PERMISSION_DENIED:
                    errorMessage += "Please allow location access.";
                    break;
                case error.POSITION_UNAVAILABLE:
                    errorMessage += "Location unavailable.";
                    break;
                case error.TIMEOUT:
                    errorMessage += "Location request timed out.";
                    break;
                default:
                    errorMessage += "Unknown error occurred.";
                    break;
            }
            
            updateStatus(errorMessage, 'error');
            searchBtn.disabled = false;
            searchBtn.textContent = "Find Nearby Restaurants";
        },
        {
            enableHighAccuracy: true,
            timeout: 10000
        }
    );
}

async function searchWithOverpassAPI() {
    updateStatus('üîç Searching OpenStreetMap data...', 'success');
    document.getElementById('results').innerHTML = '<div class="loading">Searching for restaurants...</div>';

    // Overpass API query to find restaurants within 5km
    const overpassQuery = `
        [out:json][timeout:25];
        (
          node["amenity"="restaurant"](around:5000,${userLocation.lat},${userLocation.lng});
          node["amenity"="cafe"](around:5000,${userLocation.lat},${userLocation.lng});
          node["amenity"="fast_food"](around:5000,${userLocation.lat},${userLocation.lng});
        );
        out body;
        >;
        out skel qt;
    `;

    try {
        const response = await fetch('https://overpass-api.de/api/interpreter', {
            method: 'POST',
            body: 'data=' + encodeURIComponent(overpassQuery)
        });

        if (!response.ok) {
            throw new Error('Network response was not ok');
        }

        const data = await response.json();
        displayOverpassResults(data.elements);
        
    } catch (error) {
        console.error('Error fetching data:', error);
        updateStatus('‚ùå Failed to fetch restaurant data. Please try again.', 'error');
        document.getElementById('results').innerHTML = '<div class="error">Could not load restaurant data at this time.</div>';
    }
}

function displayOverpassResults(elements) {
    if (!elements || elements.length === 0) {
        updateStatus('‚ùå No restaurants found in your area', 'error');
        document.getElementById('results').innerHTML = '<div class="error">No restaurants found within 5km radius.</div>';
        return;
    }

    // Filter and sort restaurants
    const restaurants = elements
        .filter(element => element.tags && element.tags.name)
        .slice(0, 20); // Limit to 20 results

    updateStatus(`‚úÖ Found ${restaurants.length} places near you!`, 'success');

    let html = '';
    restaurants.forEach(place => {
        const name = place.tags.name || 'Unnamed Restaurant';
        const cuisine = place.tags.cuisine ? ` ‚Ä¢ ${place.tags.cuisine}` : '';
        const address = place.tags['addr:street'] || '';
        
        html += `
            <div class="place">
                <strong>${name}</strong>${cuisine}<br>
                ${address ? `üìç ${address}` : ''}
                ${place.tags.website ? `<br>üåê <a href="${place.tags.website}" target="_blank">Website</a>` : ''}
            </div>
        `;
    });

    document.getElementById('results').innerHTML = html;
}
</script>

</body>
</html>
